<% content_for :title, t('show_facility') %>
<% breadcrumb :facility, @facility %>

<div class="mx-auto max-w-7xl px-4">
  <%= render "shared/flash_message" %>

  <h1 class="my-4 font-bold text-2xl"><%= t('show_facility') %></h1>

  <%= render 'facilities/facility',
           facility: @facility,
           show_actions: false,
           full_image: true %>

  <!-- data-markersï¼ˆmarker.to_jsonï¼‰ã¸ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›ç”¨ -->
  <% marker =
    if @facility.latitude.present? && @facility.longitude.present?
      [{
        id:      @facility.id,
        lat:     @facility.latitude.to_f,
        lng:     @facility.longitude.to_f,
        title:   @facility.title,
        address: @facility.respond_to?(:full_address) ? @facility.full_address : [@facility.prefecture&.name, @facility.city, @facility.street, @facility.building].compact.join,
        url:     facility_path(@facility)
      }]
    else
      []
    end
  %>

  <!-- åœ°å›³è¡¨ç¤º -->
  <div id="index-map"
      class="mx-auto max-w-7xl h-[480px] rounded-md border border-gray-200"
      style="min-height: 480px"
      data-markers="<%= marker.to_json %>"
      data-zoom="8"
      data-min-zoom="6"
      data-zoom-single="16">
  </div>

  <div class="my-6 flex flex-col items-end gap-4">
    <%= link_to t('buttons.back_to_list'), facilities_path, class: "btn-primary bg-yellow-200" %>
    <%# æŠ•ç¨¿è€…ãŒãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨åŒã˜å ´åˆã€ç·¨é›†ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º %>
    <% if @facility.user == current_user %>
      <%= link_to t('helpers.facilities.edit'), edit_facility_path(@facility), class: "btn-primary bg-amber-400" %>
      <%= button_to t('helpers.facilities.delete'), @facility, method: :delete, class: "mb-12 rounded-md px-3.5 py-2.5 text-white bg-red-600 hover:bg-red-500 font-medium" %>
    <% end %>
  </div>

  <% share_text = "#{@facility.title}ï½œçŠ¬ã¨è¡Œã‘ã‚‹ã‚¹ãƒãƒƒãƒˆ ðŸ¶" %>
  <% share_url  = add_utm(request.original_url) %>

  <div class="my-4 flex">
    <%= link_to "Xã§å…±æœ‰",
      share_on_x_url(text: share_text, url: share_url, hashtags: %w[çŠ¬é€£ã‚Œ ã‚ã‚“ã“ãŸã³], via: "WankoTabi"),
      target: "_blank", rel: "noopener", data: { turbo: false },
      class: "ml-auto inline-flex items-center gap-2 rounded-md bg-[#111] px-4 py-2 text-white hover:opacity-90" %>
  </div>

  <%= render 'comments/form', facility: @facility, comment: @comment %>
  <%= render @comments, facility: @facility %>
</div>
